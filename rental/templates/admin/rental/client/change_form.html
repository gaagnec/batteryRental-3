{% extends "admin/change_form.html" %}
{% load static %}
{% load custom_filters %}

{% block content %}
<style>
  .balance-green { 
    background-color: #155724; 
    color: #d4edda;
    padding: 4px;
    border-radius: 6px;
  }
  .balance-yellow { background-color: #fff3cd; }
  .balance-red { 
    background-color: #721c24; 
    color: #f8d7da;
    padding: 4px;
    border-radius: 6px;
  }
  .balance-gray { background-color: #e2e3e5; }
  .rental-info { margin-bottom: 1em; padding: 0.5em; border: 1px solid #ccc; border-radius: 4px; }
  .rental-row { margin-bottom: 0.5em; }
  .payments-table { 
    width: 100%; 
    border-collapse: collapse; 
    margin-top: 1em;
    background-color: #1c1e2d;
    color: #9fa6bc;
  }
  .payments-table th, .payments-table td { 
    border: 1px solid #2a2e41; 
    padding: 8px; 
  }
  .payments-table th { 
    background-color: #0e1018; 
    color: #9fa6bc;
    font-weight: 500;
  }
  .payments-table tbody tr {
    background-color: #1c1e2d;
  }
  .payments-table tbody tr:hover {
    background-color: #252840;
  }
</style>

<h1>{{ original.name }}</h1>

<div class="rental-info">
  {% for rental in rental_data %}

  <div class="rental-row">
    <strong>Договор {{ rental.contract_code }} ({{ rental.version_range }})</strong>, с {{ rental.start|date:"d.m.Y" }} по {{ rental.end|default:"сейчас"|date:"d.m.Y" }}, дней всего: {{ rental.days_total }}, активных дней: {{ rental.billable_days }}
    <a href="{{ rental.url }}">[ссылка]</a>
  </div>
  <div class="rental-row">
    {% with balance=rental.balance deposit=rental.deposit color=rental.color %}
      {% if color == 'green' %}
        <span class="balance-green">Баланс: {{ balance|floatformat:2 }}</span>
      {% elif color == 'yellow' %}
        <span class="balance-yellow">Баланс: {{ balance|floatformat:2 }}</span>
      {% elif color == 'gray' %}
        <span class="balance-gray">Баланс: {{ balance|floatformat:2 }}</span>
      {% else %}
        <span class="balance-red">Баланс: {{ balance|floatformat:2 }}</span>
      {% endif %}
      <span>Должен: {{ rental.charges|floatformat:2 }}</span>, <span>Оплатил: {{ rental.paid|floatformat:2 }}</span>, <span>Депозит: {{ deposit|floatformat:2 }}</span>
    {% endwith %}
  </div>
  {% endfor %}
</div>

<h2>Платежи</h2>
<table class="payments-table">
  <thead>
    <tr><th>Дата</th><th>Сумма</th><th>Метод</th><th>Комментарий</th><th>Ввел</th></tr>
  </thead>
  <tbody>
    {% for payment in payments %}
    <tr>
      <td>{{ payment.date|date:"d.m.Y" }}</td>
      <td>{{ payment.amount|floatformat:2 }}</td>
      <td>{{ payment.method }}</td>
      <td>{{ payment.note }}</td>
      <td>{% if payment.created_by %}{{ payment.created_by.get_full_name|default:payment.created_by.username|default:payment.created_by.email }}{% else %}-{% endif %}</td>
    </tr>
    {% empty %}
    <tr><td colspan="5">Платежей нет</td></tr>
    {% endfor %}
  </tbody>
</table>

{{ block.super }}
{% endblock %}
