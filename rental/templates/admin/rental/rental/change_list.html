{% extends "admin/change_list.html" %}
{% load i18n %}

{% block extrahead %}
  {{ block.super }}
  <style>
    /* Hide default right sidebar filter */
    #changelist-filter { display: none !important; }

    /* Make content stretch full width */
    #content { width: 100% !important; max-width: none !important; }
    #changelist, .changelist-form-container, .results { width: 100% !important; }
    .changelist-form-container { margin: 0 !important; display: block !important; }

    /* Top synchronized scroll bar spans full width */
    .top-scroll { overflow-x: auto; height: 16px; margin: 0 0 .25rem 0; width: 100% !important; }
    .top-scroll .spacer { height: 1px; }

    /* Temporary: hide top scroll bar as requested */
    #top-scroll { display: none !important; }

    /* Make headers wrap to allow two-line labels */
    #result_list thead th { white-space: normal; word-break: break-word; vertical-align: middle; }
    #result_list thead th .two-lines { display: inline-block; line-height: 1.1; }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Apply Bootstrap-like classes to Django admin result table
      const tbl = document.getElementById('result_list');
      if (tbl) {
        tbl.classList.add('table','table-sm','table-hover','table-striped');
      }
      // Create top scroll that mirrors bottom
      const chg = document.getElementById('changelist');
      if (!chg) return;
      let top = document.getElementById('top-scroll');
      if (!top) {
        top = document.createElement('div');
        top.id = 'top-scroll';
        top.className = 'top-scroll';
        const spacer = document.createElement('div');
        spacer.className = 'spacer';
        spacer.style.width = '100%';
        top.appendChild(spacer);
        chg.insertBefore(top, chg.firstChild);
      }
      const container = document.querySelector('.results') || (tbl && tbl.parentElement);
      const updateWidth = () => {
        const target = tbl;
        if (top && target) {
          top.firstChild.style.width = target.scrollWidth + 'px';
        }
      };
      const sync = (src, dst) => { dst.scrollLeft = src.scrollLeft; };
      if (container && top) {
        updateWidth();
        top.addEventListener('scroll', () => sync(top, container));
        container.addEventListener('scroll', () => sync(container, top));
        window.addEventListener('resize', updateWidth);
        setTimeout(updateWidth, 200);
      }
      const actions = document.querySelector('.changelist-form-container .actions');
      if (actions) {
        actions.classList.add('compact-row');
        actions.querySelectorAll('select, input[type="text"], input[type="number"], input[type="date"]').forEach(el => {
          el.classList.add('form-control','form-control-sm');
        });
        actions.querySelectorAll('button, input[type="submit"]').forEach(el => {
          el.classList.add('btn','btn-sm','btn-primary');
        });
      }

    });
  </script>

  <style>
    .input-group > * {
      flex: 1 1 0%;
      min-width: 0;
    }
    .input-group-sm > * {
      font-size: 0.875rem;
      padding: 0.25rem 0.5rem;
    }
    .compact-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .compact-row > * {
      flex: 1 1 calc(33.333% - 0.5rem);
      min-width: 0;
    }
  </style>
{% endblock %}

{% block object-tools-items %}
  {# Centered filter controls replacing sidebar filters #}
  <li class="d-flex w-100 justify-content-center" style="list-style:none;">
    <div class="btn-group btn-group-sm" role="group" aria-label="Filters">
      {% with cur=request.GET.status__exact %}
        <a class="btn {% if not cur %}btn-secondary{% else %}btn-outline-secondary{% endif %}" href=".">{% trans "All" %}</a>
        <a class="btn {% if cur == 'active' %}btn-primary{% else %}btn-outline-primary{% endif %}" href="?status__exact=active">Активен</a>
        <a class="btn {% if cur == 'modified' %}btn-primary{% else %}btn-outline-primary{% endif %}" href="?status__exact=modified">Модифицирован</a>
        <a class="btn {% if cur == 'closed' %}btn-primary{% else %}btn-outline-primary{% endif %}" href="?status__exact=closed">Закрыт</a>
      {% endwith %}
    </div>
  </li>

  <li class="d-flex w-100 justify-content-center mt-2" style="list-style:none;">
    <input id="client-search" class="form-control form-control-sm" type="text" placeholder="Поиск клиента..." aria-label="Поиск клиента" autocomplete="off" list="client-list" style="max-width: 300px;">
    <datalist id="client-list">
      {% for client in clients %}
        <option value="{{ client.name }}"></option>
      {% endfor %}
    </datalist>
  </li>

  {{ block.super }}
{% endblock %}

{% block result_list %}
  <div class="table-responsive">
    {{ block.super }}
  </div>
{% endblock %}
